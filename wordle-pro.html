<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coasterdle Pro - Modo Experto</title>
    <style>
        :root { --bg: #121213; --card: #272729; --accent: #538d4e; --border: #3a3a3c; --text: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        
        .header { text-align: center; margin-bottom: 20px; width: 100%; max-width: 950px; }
        .table-container { width: 100%; max-width: 950px; overflow-x: auto; margin-bottom: 20px; border-radius: 8px; }
        
        table { width: 100%; border-collapse: collapse; min-width: 700px; background: var(--card); }
        th { border-bottom: 2px solid var(--border); padding: 12px; font-size: 0.75rem; text-transform: uppercase; color: #aaa; }
        td { border-bottom: 1px solid var(--border); padding: 15px 5px; text-align: center; font-size: 0.9rem; }

        .search-area { width: 100%; max-width: 500px; position: relative; margin-bottom: 20px; }
        input { width: 100%; padding: 15px; background: var(--card); border: 2px solid var(--border); color: white; border-radius: 8px; font-size: 1rem; outline: none; }
        input:focus { border-color: var(--accent); }
        
        .suggestions { position: absolute; bottom: 100%; left: 0; width: 100%; background: var(--card); border: 1px solid var(--border); max-height: 200px; overflow-y: auto; z-index: 100; box-shadow: 0 -5px 15px rgba(0,0,0,0.5); }
        .sugg-item { padding: 12px; cursor: pointer; border-bottom: 1px solid var(--border); text-align: left; }
        .sugg-item:hover { background: #3a3a3c; }

        .hint-box { background: #1a2a3a; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: none; border: 1px dashed #00d9ff; width: 100%; max-width: 500px; text-align: center; }
        
        .icon { font-weight: bold; margin-left: 4px; }
        .up { color: #ff4444; }
        .down { color: #44aaff; }
        .check { color: #538d4e; }
        .wrong { color: #ff4444; }

        .btn-hint { background: #b59f3b; color: black; border: none; padding: 12px 25px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 10px; display: none; transition: 0.3s; }
        .btn-hint:hover { background: #d4bc4d; }
    </style>
</head>
<body>

    <div class="header">
        <h1>COASTERDLE PRO</h1>
        <div id="tries" style="font-weight: bold; color: #ffd700; font-size: 1.2rem;">Intento 1 de 6</div>
    </div>

    <div id="hint-display" class="hint-box"></div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Pa√≠s</th>
                    <th>Fabricante</th>
                    <th>Invers.</th>
                    <th>Altura</th>
                    <th>Longitud</th>
                    <th>Veloc.</th>
                </tr>
            </thead>
            <tbody id="game-body"></tbody>
        </table>
    </div>

    <div class="search-area">
        <div id="suggestions" class="suggestions" style="display:none"></div>
        <input type="text" id="guess-input" placeholder="Escribe una monta√±a rusa..." autocomplete="off">
        <center><button id="hint-btn" class="btn-hint" onclick="revealHint()">üí° PISTA DISPONIBLE</button></center>
    </div>

    <div id="msg" style="font-size: 1.5rem; font-weight: bold; margin-top: 20px; text-align: center;"></div>

    <script>
        const DB_URL = "https://raw.githubusercontent.com/jalfaro17/coaster-data/main/db.json";
        let db = [], target, attempts = 0;
        const maxAttempts = 6;

        async function init() {
            try {
                const res = await fetch(DB_URL + "?t=" + Date.now());
                db = await res.json();
                target = db[Math.floor(Math.random() * db.length)];
                console.log("Secret Target:", target.n); 
            } catch (e) { alert("Error al conectar con la base de datos."); }
        }

        function getComparison(valGuess, valTarget, isNumeric) {
            if (valGuess === valTarget) return ' <span class="check">‚úÖ</span>';
            if (!isNumeric) return ' <span class="wrong">‚ùå</span>';
            
            const g = parseFloat(valGuess) || 0;
            const t = parseFloat(valTarget) || 0;
            if (t > g) return ' <span class="up">‚¨ÜÔ∏è</span>';
            if (t < g) return ' <span class="down">‚¨áÔ∏è</span>';
            return ' <span class="check">‚úÖ</span>';
        }

        function submitGuess(coaster) {
            if (attempts >= maxAttempts) return;
            attempts++;
            
            const body = document.getElementById('game-body');
            const row = document.createElement('tr');

            const dataPoints = [
                { val: coaster.n, target: target.n, num: false },
                { val: coaster.p, target: target.p, num: false },
                { val: coaster.f, target: target.f, num: false },
                { val: coaster.i, target: target.i, num: true },
                { val: coaster.h || "0", target: target.h || 0, num: true },
                { val: coaster.l || "0", target: target.l || 0, num: true },
                { val: coaster.v || "0", target: target.v || 0, num: true }
            ];

            dataPoints.forEach(dp => {
                const td = document.createElement('td');
                td.innerHTML = dp.val + getComparison(dp.val, dp.target, dp.num);
                row.appendChild(td);
            });

            body.insertBefore(row, body.firstChild); // A√±adir arriba para ver mejor
            document.getElementById('tries').innerText = attempts < 6 ? `Intento ${attempts + 1} de 6` : `Fin de los intentos`;
            
            // Mostrar bot√≥n de pista en el 3 y 5
            if (attempts === 3 || attempts === 5) {
                document.getElementById('hint-btn').style.display = 'inline-block';
            } else {
                document.getElementById('hint-btn').style.display = 'none';
            }

            if (coaster.n === target.n) {
                document.getElementById('msg').innerHTML = "<span style='color:var(--accent)'>üèÜ ¬°BRUTAL! Has acertado.</span>";
                endGame();
            } else if (attempts === maxAttempts) {
                document.getElementById('msg').innerHTML = "üíÄ Game Over. Era: " + target.n;
                endGame();
            }
        }

        function revealHint() {
            const display = document.getElementById('hint-display');
            display.style.display = 'block';
            
            if (attempts >= 5) {
                // Pista del Parque: Primera letra + guiones
                let pName = target.pk;
                let hiddenPark = pName[0] + pName.substring(1).replace(/[a-zA-Z0-9]/g, "_");
                display.innerHTML = `<strong>PISTA INTENTO 5 (Parque):</strong> <code>${hiddenPark}</code>`;
            } else if (attempts >= 3) {
                // Pista del Nombre: Primera letra + guiones
                let nName = target.n;
                let hiddenName = nName[0] + nName.substring(1).replace(/[a-zA-Z0-9]/g, "_");
                display.innerHTML = `<strong>PISTA INTENTO 3 (Nombre):</strong> <code>${hiddenName}</code>`;
            }
            document.getElementById('hint-btn').style.display = 'none';
        }

        function endGame() {
            document.getElementById('guess-input').disabled = true;
            document.getElementById('suggestions').style.display = 'none';
        }

        // Buscador
        const input = document.getElementById('guess-input');
        const suggBox = document.getElementById('suggestions');

        input.addEventListener('input', () => {
            const val = input.value.toLowerCase();
            suggBox.innerHTML = "";
            if (val.length < 2) { suggBox.style.display = 'none'; return; }

            const filtered = db.filter(c => c.n.toLowerCase().includes(val)).slice(0, 6);
            if (filtered.length > 0) {
                suggBox.style.display = 'block';
                filtered.forEach(c => {
                    const div = document.createElement('div');
                    div.className = 'sugg-item';
                    div.innerText = `${c.n} (${c.pk})`;
                    div.onclick = () => {
                        input.value = "";
                        suggBox.style.display = 'none';
                        submitGuess(c);
                    };
                    suggBox.appendChild(div);
                });
            }
        });

        init();
    </script>
</body>
</html>

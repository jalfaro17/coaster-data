<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coasterdle Pro - Ultimate Edition</title>
    <style>
        :root { --bg: #121213; --card: #272729; --accent: #538d4e; --border: #3a3a3c; --text: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        
        /* Selector de Idioma */
        .lang-selector { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; }
        .lang-btn { font-size: 2rem; cursor: pointer; filter: grayscale(0.6); transition: 0.3s; background: none; border: none; }
        .lang-btn.active { filter: grayscale(0); transform: scale(1.2); }

        .header { text-align: center; margin-bottom: 20px; width: 100%; max-width: 1000px; }
        .table-container { width: 100%; max-width: 1000px; overflow-x: auto; margin-bottom: 20px; border-radius: 8px; }
        
        table { width: 100%; border-collapse: collapse; min-width: 800px; background: var(--card); }
        th { border-bottom: 2px solid var(--border); padding: 12px; font-size: 0.75rem; text-transform: uppercase; color: #aaa; }
        td { border-bottom: 1px solid var(--border); padding: 15px 5px; text-align: center; font-size: 0.9rem; }

        .search-area { width: 100%; max-width: 500px; position: relative; margin-bottom: 20px; }
        input { width: 100%; padding: 15px; background: var(--card); border: 2px solid var(--border); color: white; border-radius: 8px; font-size: 1rem; outline: none; }
        
        .suggestions { position: absolute; bottom: 100%; left: 0; width: 100%; background: var(--card); border: 1px solid var(--border); max-height: 200px; overflow-y: auto; z-index: 100; }
        .sugg-item { padding: 12px; cursor: pointer; border-bottom: 1px solid var(--border); text-align: left; }
        .sugg-item:hover { background: #3a3a3c; }

        /* Pistas Grandes y Espaciadas */
        .hint-box { background: #1a2a3a; padding: 20px; border-radius: 12px; margin-bottom: 15px; display: none; border: 2px dashed #00d9ff; width: 100%; max-width: 600px; text-align: center; }
        .hint-text { font-family: monospace; font-size: 1.8rem; letter-spacing: 8px; font-weight: bold; color: #00d9ff; display: block; margin-top: 10px; }
        
        .check { color: #538d4e; } .wrong { color: #ff4444; } .up { color: #ff4444; } .down { color: #44aaff; }

        .btn-hint { background: #b59f3b; color: black; border: none; padding: 12px 25px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 10px; display: none; }
        #msg { padding: 20px; border-radius: 10px; font-size: 1.2rem; text-align: center; max-width: 600px; }
    </style>
</head>
<body>

    <div class="lang-selector">
        <button class="lang-btn active" onclick="setLang('es')" id="btn-es">üá™üá∏</button>
        <button class="lang-btn" onclick="setLang('en')" id="btn-en">üá¨üáß</button>
    </div>

    <div class="header">
        <h1 id="txt-title">COASTERDLE PRO</h1>
        <div id="tries" style="font-weight: bold; color: #ffd700; font-size: 1.2rem;">Intento 1 de 6</div>
    </div>

    <div id="hint-display" class="hint-box"></div>

    <div class="table-container">
        <table>
            <thead>
                <tr id="table-head">
                    </tr>
            </thead>
            <tbody id="game-body"></tbody>
        </table>
    </div>

    <div class="search-area">
        <div id="suggestions" class="suggestions" style="display:none"></div>
        <input type="text" id="guess-input" placeholder="Buscar..." autocomplete="off">
        <center><button id="hint-btn" class="btn-hint" onclick="revealHint()">üí° PISTA</button></center>
    </div>

    <div id="msg"></div>

    <script>
        const DB_URL = "https://raw.githubusercontent.com/jalfaro17/coaster-data/main/db.json";
        let db = [], target, attempts = 0, currentLang = 'es';
        const maxAttempts = 6;

        const i18n = {
            es: {
                title: "COASTERDLE PRO", tries: "Intento", hintBtn: "üí° PISTA DISPONIBLE",
                placeholder: "Escribe una monta√±a rusa...", win: "üèÜ ¬°HAS ACERTADO!",
                loss: "üíÄ FIN DEL JUEGO", park: "Parque", country: "Pa√≠s",
                cols: ["Nombre", "Pa√≠s", "Fabricante", "Invers.", "A√±o", "Altura", "Long.", "Veloc."]
            },
            en: {
                title: "COASTERDLE PRO", tries: "Attempt", hintBtn: "üí° HINT AVAILABLE",
                placeholder: "Type a roller coaster...", win: "üèÜ YOU GUESSED IT!",
                loss: "üíÄ GAME OVER", park: "Park", country: "Country",
                cols: ["Name", "Country", "Manufacturer", "Invers.", "Year", "Height", "Length", "Speed."]
            }
        };

        function setLang(lang) {
            currentLang = lang;
            document.getElementById('btn-es').classList.toggle('active', lang === 'es');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');
            updateUI();
        }

        function updateUI() {
            const t = i18n[currentLang];
            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('guess-input').placeholder = t.placeholder;
            const head = document.getElementById('table-head');
            head.innerHTML = t.cols.map(c => `<th>${c}</th>`).join('');
        }

        async function init() {
            try {
                const res = await fetch(DB_URL + "?t=" + Date.now());
                db = await res.json();
                target = db[Math.floor(Math.random() * db.length)];
                console.log("Target:", target.n);
                setLang('es');
            } catch (e) { alert("Error DB"); }
        }

        function getComparison(valGuess, valTarget, isNumeric) {
            if (valGuess == valTarget) return ' <span class="check">‚úÖ</span>';
            if (!isNumeric) return ' <span class="wrong">‚ùå</span>';
            const g = parseFloat(valGuess) || 0;
            const t = parseFloat(valTarget) || 0;
            return t > g ? ' <span class="up">‚¨ÜÔ∏è</span>' : ' <span class="down">‚¨áÔ∏è</span>';
        }

        function submitGuess(coaster) {
            if (attempts >= maxAttempts) return;
            attempts++;
            const body = document.getElementById('game-body');
            const row = document.createElement('tr');

            const dataPoints = [
                { v: coaster.n, t: target.n, n: false },
                { v: coaster.p, t: target.p, n: false },
                { v: coaster.f, t: target.f, n: false },
                { v: coaster.i, t: target.i, n: true },
                { v: coaster.y || 2000, t: target.y || 2010, n: true }, // A√±o (y)
                { v: coaster.h || 0, t: target.h || 0, n: true },
                { v: coaster.l || 0, t: target.l || 0, n: true },
                { v: coaster.v || 0, t: target.v || 0, n: true }
            ];

            dataPoints.forEach(dp => {
                const td = document.createElement('td');
                td.innerHTML = dp.v + getComparison(dp.v, dp.t, dp.n);
                row.appendChild(td);
            });

            body.insertBefore(row, body.firstChild);
            document.getElementById('tries').innerText = `${i18n[currentLang].tries} ${attempts} / 6`;
            
            if (attempts === 3 || attempts === 5) document.getElementById('hint-btn').style.display = 'inline-block';
            else document.getElementById('hint-btn').style.display = 'none';

            if (coaster.n === target.n) {
                showFinalMsg(true);
            } else if (attempts === maxAttempts) {
                showFinalMsg(false);
            }
        }

        function showFinalMsg(win) {
            const t = i18n[currentLang];
            const msg = document.getElementById('msg');
            msg.style.background = win ? "#1b3d1b" : "#3d1b1b";
            msg.innerHTML = `<strong>${win ? t.win : t.loss}</strong><br>
                            <span style="font-size:1.5rem">${target.n}</span><br>
                            ${t.park}: ${target.pk} | ${t.country}: ${target.p}`;
            document.getElementById('guess-input').disabled = true;
        }

        function revealHint() {
            const display = document.getElementById('hint-display');
            display.style.display = 'block';
            let text = "";
            if (attempts >= 5) {
                text = target.pk[0] + target.pk.substring(1).replace(/[a-zA-Z0-9]/g, "_");
                display.innerHTML = `PISTA: ${i18n[currentLang].park}<br><span class="hint-text">${text}</span>`;
            } else {
                text = target.n[0] + target.n.substring(1).replace(/[a-zA-Z0-9]/g, "_");
                display.innerHTML = `PISTA: ${i18n[currentLang].cols[0]}<br><span class="hint-text">${text}</span>`;
            }
            document.getElementById('hint-btn').style.display = 'none';
        }

        // Buscador
        const input = document.getElementById('guess-input');
        input.addEventListener('input', () => {
            const val = input.value.toLowerCase();
            const suggBox = document.getElementById('suggestions');
            suggBox.innerHTML = "";
            if (val.length < 2) { suggBox.style.display = 'none'; return; }
            const filtered = db.filter(c => c.n.toLowerCase().includes(val)).slice(0, 6);
            if (filtered.length > 0) {
                suggBox.style.display = 'block';
                filtered.forEach(c => {
                    const div = document.createElement('div');
                    div.className = 'sugg-item';
                    div.innerText = `${c.n} (${c.pk})`;
                    div.onclick = () => { input.value = ""; suggBox.style.display = 'none'; submitGuess(c); };
                    suggBox.appendChild(div);
                });
            }
        });

        init();
    </script>
</body>
</html>
